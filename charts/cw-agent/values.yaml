# Default values for cw-agent
# This is a YAML-formatted file.

replicaCount: 1

image:
  repository: ghcr.io/certwatch-app/cw-agent
  pullPolicy: IfNotPresent
  # Overrides the image tag (defaults to appVersion)
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# ============================================================
# CertWatch API Configuration
# ============================================================
api:
  # CertWatch API endpoint
  endpoint: "https://api.certwatch.app"
  # Request timeout
  timeout: "30s"

# ============================================================
# API Key Configuration - REQUIRED
# ============================================================
# Choose ONE of the following options:
#
# OPTION 1: Direct value (convenient for testing)
#   helm install cw-agent ... --set apiKey.value=cw_xxx
#   WARNING: The key will be stored in Helm release history.
#   Use existingSecret for production deployments.
#
# OPTION 2: Existing secret (recommended for production)
#   kubectl create secret generic cw-agent-api-key --from-literal=api-key=cw_xxx
#   helm install cw-agent ... --set apiKey.existingSecret.name=cw-agent-api-key
#
apiKey:
  # Option 1: Provide API key directly (Helm will create a Secret)
  # WARNING: Not recommended for production - visible in Helm history
  value: ""

  # Option 2: Use an existing Kubernetes Secret (recommended)
  existingSecret:
    # Name of the existing secret containing the API key
    name: ""
    # Key within the secret that contains the API key
    key: "api-key"

# ============================================================
# Agent Configuration
# ============================================================
agent:
  # Unique name for this agent (required)
  name: ""
  # Log level: debug, info, warn, error
  logLevel: "info"
  # How often to sync with CertWatch cloud
  syncInterval: "5m"
  # How often to scan certificates locally
  scanInterval: "1m"
  # Maximum concurrent certificate scans
  concurrency: 10
  # Heartbeat interval for offline alerts (0 to disable)
  heartbeatInterval: "30s"
  # Prometheus metrics port (0 to disable)
  metricsPort: 8080

# ============================================================
# Certificates to Monitor
# ============================================================
# Option 1: Inline certificates (simple)
certificates: []
  # - hostname: "api.example.com"
  #   port: 443
  #   tags:
  #     - production
  #     - api
  #   notes: "Main API endpoint"
  # - hostname: "www.example.com"
  #   port: 443

# Option 2: External ConfigMap (for managed deployments)
# Reference an existing ConfigMap containing certwatch.yaml
existingConfigMap:
  # Name of existing ConfigMap
  name: ""
  # Key containing the certwatch.yaml content
  key: "certwatch.yaml"

# ============================================================
# Kubernetes Resources
# ============================================================
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  fsGroup: 65534

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

service:
  type: ClusterIP
  port: 8080

resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 10m
    memory: 32Mi

# ============================================================
# Probes
# ============================================================
livenessProbe:
  httpGet:
    path: /livez
    port: metrics
  initialDelaySeconds: 30
  periodSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /readyz
    port: metrics
  initialDelaySeconds: 5
  periodSeconds: 5
  failureThreshold: 3

# ============================================================
# Prometheus ServiceMonitor (requires Prometheus Operator)
# ============================================================
serviceMonitor:
  # Create a ServiceMonitor resource for Prometheus Operator
  enabled: false
  # Namespace for ServiceMonitor (defaults to release namespace)
  namespace: ""
  # Scrape interval
  interval: "30s"
  # Additional labels for ServiceMonitor
  labels: {}

# ============================================================
# Pod Disruption Budget
# ============================================================
podDisruptionBudget:
  # Create a PodDisruptionBudget
  enabled: false
  # Minimum available pods (number or percentage like "50%")
  # minAvailable: 1
  # Maximum unavailable pods (number or percentage)
  # maxUnavailable: 1

# ============================================================
# Scheduling
# ============================================================
nodeSelector: {}

tolerations: []

affinity: {}
